version: v1.0
name: Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Build & run only on something
    task:
      jobs:
        - name: Tests
          commands:
            - checkout
            - go run ./main.go
            - cat file
  - name: Tag git version
    task:
      jobs:
        - commands:
            - checkout
            - chmod 0600 ~/.ssh/id_rsa_semaphoreci
            - ssh-add ~/.ssh/id_rsa_semaphoreci
            - git config --global user.email "you@example.com"
            - git config --global user.name "Your Name"
            - pip3 install auto-tag
            - '~/.local/bin/auto-tag --skip-tag-if-one-already-present -u origin -b ${SEMAPHORE_GIT_BRANCH}'
          name: Tag git version
      secrets:
        - name: private-repo-hamir
